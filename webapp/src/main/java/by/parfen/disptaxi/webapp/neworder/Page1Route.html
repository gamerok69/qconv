<wicket:head>
<link rel="stylesheet" type="text/css" href="css/wicket_ac.css" />
<script src="http://api-maps.yandex.ru/1.1/?lang=ru_RU" type="text/javascript"></script>
</wicket:head>

<wicket:extend xmlns:wicket="http://wicket.apache.org">
	<h1><wicket:message key="p.neworder.createRouteTitle" /></h1>

	<table>
		<tr>			<td valign="top">
				<form wicket:id="addressForm">
					<div id="pointSrc">
						<label class="inputForm-label"><wicket:message key="p.point.cityTitle" /></label>
						<input wicket:id="cityName" class="inputForm-text" type="text" size="20"/>
						
						<label class="inputForm-label"><wicket:message key="p.neworder.searchAddressTitle" /></label>
						<input type="text" wicket:id="acStreet" size="20" class="inputForm-text" />
						<input type="text" wicket:id="acPoint" size="4" class="inputForm-text" />
						<a href="#" class="button green medium" onclick="SearchLocation(1)"><wicket:message key="p.point.searchByAddress"/></a>
						<br/>
						<input id="pointLat" class="inputForm-text" type="text" size="6"/>
						<input id="pointLng" class="inputForm-text" type="text" size="6" />
						
						<label class="inputForm-label"><wicket:message key="p.neworder.srcPointTitle" /></label>
						<input type="text" size="20" class="inputForm-text" />
						<input type="text" size="4" class="inputForm-text" />
						<a href="#" class="button green medium">&lArr; <wicket:message key="p.neworder.setPoint"/></a>
						<br/>
						<input id="srcPointLat" class="inputForm-text" type="text" size="6"/>
						<input id="srcPointLng" class="inputForm-text" type="text" size="6" />

						<label class="inputForm-label"><wicket:message key="p.neworder.dstPointTitle" /></label>
						<input type="text" size="20" class="inputForm-text" />
						<input type="text" size="4" class="inputForm-text" />
						<a href="#" class="button green medium">&lArr; <wicket:message key="p.neworder.setPoint"/></a>
						<br/>
						<input id="dspPointLat" class="inputForm-text" type="text" size="6"/>
						<input id="dspPointLng" class="inputForm-text" type="text" size="6" />

						<div class="inputForm-buttons">
						<a href="#" class="button green medium"><wicket:message key="p.neworder.calculateRoute"/></a>
						</div>
						
						<br/>
						<span wicket:id="label" class="inputForm-label"></span>
						<div id="info"></div>
					</div>
				</form>
			</td>

			<td valign="middle">
				<div id="yandexMap"
					style="width: 500px; float-reference: inline; float: block-end; height: 450px"></div>
			</td>

		</tr>
	</table>

	<form wicket:id="inputForm">
		<fieldset>
			<div>
				<div class="inputForm-buttons">
				<button type="submit" wicket:id="sumbitLink" class="button green bigrounded"><wicket:message key="p.neworder.page1.nextButton" /></button>
				<button type="submit" wicket:id="cancelLink" class="button gray bigrounded"><wicket:message key="p.inputForm.cancelButton" /></button>
				</div>
			</div>
		</fieldset>
	</form>

	<script>
		function SearchLocation(signSet) {
			var address;
			var pointName = document.getElementById("acPoint").value;
			var streetName = document.getElementById("acStreet").value;
			var cityName = document.getElementById("cityName").value;
			mapZoom = "17";
			mapCenter = new YMaps.GeoPoint(23.84, 53.64);

			var mapY = new YMaps.Map(document.getElementById("yandexMap"));
			mapY.setCenter(mapCenter, mapZoom);

			address = cityName + ", " + streetName + ", " + pointName;
			var geocoder = new YMaps.Geocoder(address);
			YMaps.Events.observe(geocoder, geocoder.Events.Load, function() {
				if (this.length()) {
					//mapY.addOverlay(this.get(0));
					mapY.panTo(this.get(0).getGeoPoint())
					var latitude = this.get(0).getGeoPoint().getLat();
					var longitude = this.get(0).getGeoPoint().getLng();
					var infoContainer = document.getElementById("info");
					infoContainer.innerHTML = address + "<br/>" + this.length()
							+ "(" + longitude.toFixed(6) + ", "
							+ latitude.toFixed(6) + ")";
					if (signSet == 1) {
						document.getElementById("pointLat").value = latitude;
						document.getElementById("pointLng").value = longitude;
					}
					placemark = new YMaps.Placemark(this.get(0).getGeoPoint(),
							{
								draggable : true,
								style : "default#redPoint"
							});
					placemark.setIconContent(address);
					mapY.addOverlay(placemark);
					YMaps.Events.observe(placemark, placemark.Events.Drag,
							function(obj) {
								document.getElementById("pointLng").value = obj.getGeoPoint().getLng().toFixed(6);
								document.getElementById("pointLat").value = obj.getGeoPoint().getLat().toFixed(6);
							});
				} else {
					alert("Ничего не найдено");
				}
			});
		}

		window.onload = function() {
			SearchLocation()
		}
	</script>

</wicket:extend>